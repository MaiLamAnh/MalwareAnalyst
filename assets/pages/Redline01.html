<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redline Stealer 01</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        header {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 20px;
        }

        h1 {
            margin-top: 0;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            font-size: 24px;
            margin-top: 0;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin-bottom: 10px;
        }
        img {
            width: 100%; /* Đặt chiều rộng */
         /*  / /* Bo góc hình ảnh (tuỳ chọn) */
        }
        footer {
    text-align: center;
    background-color: #302828;
    color: #fff;
    padding: 10px;
    margin-top: 20px;
}
    </style>
</head>
<body>
    <header>
        <h1>Mai Lam Anh Cybers3c - Malware Analyst</h1>
    </header>

    <div class="container">

        <h2>Phân tích mẫu malware Redline Stealer 01</h2>
        
        
        
        <ul>
            <li><a href="#section1">Phân loại ban đầu</a></li>
            <ul>
                <li><a href="#filename">--->File name</a></li>
                <li><a href="#VT">--->Tỷ lệ phát hiện chống Anti-Virus</a></li>
                <li><a href="#resource">--->Tài nguyên </a></li>
                <li><a href="#sections">--->Sections trong file thực thi (PE file)</a></li>
                <li><a href="#imports">--->Imports</a></li>
            </ul>
            
            <li><a href="#section2">Phân tích tĩnh (Static malware analysis)</a></li>
            <ul>
                <li><a href="#redline">--->Redline Stealer là gì?</a></li>
                <li><a href="#technical">--->Phân tích kỹ thuật </a></li>
            </ul>
            <li><a href="#section4">Phân tích động (Dynamic malware analysis)</a></li>
            <ul>
                <li><a href="#behavior">--->Phân tích hành vi</a></li>
                <li><a href="#dump">--->Dump thử một số process </a></li>
            </ul>
            <li><a href="#section3">Kết luận</a></li>
        </ul>

        <section id="section1">
            <h2>Phân loại ban đầu</h2>
            <h4 id="filename">File Name</h4>
            <p>BaseChannelObjectWithPropert.exe</p>
            <p>MD5: e336cd749eb4e599192906f8d61d0bb2</p>
            <p>SHA-1: 6d431812efb3c52e0bdd44d2602bca486eacc451</p>
            <p>SHA-256: 3bd982f82a1b2f074b02fe7cc7413f1e083f19108ae2612b2b5a741a9858f7f4</p>

            <h4 id="VT">Tỷ lệ phát hiện Anti-Virus (55/71) </h4>
            <p>Tại thời điểm viết bài, mẫu đang được phân tích đã được Virustotal (VT) detect.</p>
            <img src="./../images/Readline-1.PNG">
            <h4 id="resource">Tài nguyên </h4>
            <p>File với signature dưới dạng Microsoft .NET </p>
            <img src="./../images/Readline-1.2.PNG">
            <h4 id="sections">Sections trong file thực thi (PE file) </h4>
            <img src="./../images/Readline-1.3.PNG">
            <p>Không có gì bất thường với các phần của tệp thực thi. Không tìm thấy sự khác biệt về kích thước bất thường hoặc tên phần bất thường.</p>
            <h4 id="imports">Imports</h4>
            <p>Phát hiện rất nhiều functions/API đã được sử dụng trong các mẫu malware, functions/API được phát hiện blacklist được sử dụng trong một số thư viện (.dll)   </p>
            <img src="./../images/Readline-1.4.PNG">

        </section>

        <section id="section2">
            <h2>Phân tích tĩnh (Static malware analysis) </h2>
            <h4 id="redline">Redline Stealer là gì? </h4>
            <p>Redline Stealer là một loại mã độc đánh cắp thông tin hoạt động dưới dạng Malware As A Service, cung cấp dịch vụ phát tán mã độc (Adversary Operator) và người dùng thực hiện giao dịch mã độc (Adversary Customer), hoạt động phát tán và lấy lợi nhuận riêng lẻ không phụ thuộc vào người cung cấp. Trong bài viết <a href="https://baohiemxahoi.gov.vn/chidaodieuhanh/Pages/thong-tin-bao-chi.aspx?CateID=0&ItemID=19561&OtItem=date#:~:text=Redline%20Stealer%20l%C3%A0%20m%E1%BB%99t%20lo%E1%BA%A1i,thu%E1%BB%99c%20v%C3%A0o%20ng%C6%B0%E1%BB%9Di%20cung%20c%E1%BA%A5p."> Cảnh báo lộ lọt thông tin cá nhân do các loại mã độc đánh cắp thông tin Redline Stealer</a> trên trang chính thức Bảo Hiểm xã hội Việt Nam đã đưa ra cảnh báo về loại mã độc này. Đủ thấy sức ảnh hưởng của loại mã độc liên quan rất lớn đến người dùng Việt Nam.</p>
            <img src="./../images/Readline-1.6.PNG">
            
            <h4 id="technical">Phân tích kỹ thuật </h4>
            <p>Nhìn vào entry point của chương trình chính, mình thấy rằng, nó đang thực thi một instance mới của class ‘MainForm()’. </p>
            
            <img src="./../images/Readline-1.5.PNG">
            <p>Tiếp theo mình thử đi sâu vào xem xét trong 'mainForm' và mình có thể thấy nó sử dụng <a href="https://learn.microsoft.com/en-us/dotnet/api/system.reflection?view=net-7.0">System.Reflection </a>để lấy một MethodInfo cho một phương thức có tên 'K67WB7wrc', 'K67WB7wrc' bằng cách sử dụng class reflection sẽ được loaded dynamically at runtime bằng cách sử dụng 'GetMethod', điều này đang sử dụng <a href="https://learn.microsoft.com/en-us/dotnet/framework/reflection-and-codedom/dynamically-loading-and-using-types">Custom Binder and CLR </a>để chạy code.</p>
            <img src="./../images/Readline-1.7.PNG">
            <p>Làm sao để kiểm tra nó load gì vào trong đây? Mình sẽ thử debug trước khi method.Invoke(null, new object[
                                    "4576656E74526567697374726174696F6E546F6B656E4C69737457697468436F",

                                                "6D73497A496B6C6E74",

                                                            "ChangeDetector"

                                                                    );]) được chạy để xem giá trị MethodInfo ở đây được load vào là gì nhé!</p>
        
            <img src="./../images/Readline-1.8.PNG">
            <p>Mình có thể thấy được hệ thống trả về System.Type.GetMethod ở đây có Name và FullName {Name = "c0MIdh5giS0KIBpS0s" FullName = "H5lJ05BU7EajaXhAma.c0MIdh5giS0KIBpS0s"} ? </p>
            <p>Sau quá trình cố gắng xem xét nó, mình thấy được hàm truyền 3 parameters khi được gọi:</p>
            <p>4576656E74526567697374726174696F6E546F6B656E4C69737457697468436F</p>
            <p>6D73497A496B6C6E74</p>
            <p>ChangeDetector</p>
            


            <img src="./../images/Readline-1.12.PNG">
            <p>Sau khi object result = RuntimeMethodHandle.InvokeMethod(obj, arguments, this.Signature, false); result sẽ được gán giá trị khi chạy RuntimeMethodHandle.InvokeMethod, mình sẽ xem xét các parameters đưa vào đây trước khi chạy nó. </p>
            <p>-> obj = null</p>
            <p>-> arguments là mảng, các mảng chứa giá trị như hình dưới.</p>
            <img src="./../images/Readline-1.15.PNG">
            <p>-> this.Signature là một đối tượng mình có thể thấy như sau:</p>
            <img src="./../images/Readline-1.16.PNG">

            <p>Vậy nó sẽ làm gì trong đó nhỉ? tiếp theo mình sẽ Step Info (F11) để xem kỹ hơn nè! Các bạn thấy có gì thú vị ở đây không ? ^^ "K67WB7wrc" mình đã thấy ngay từ GetMethod phía trên, có vẻ như nó ở đây. </p>
            <img src="./../images/Readline-1.17.PNG">
            <p>Bằng cách nào đó, mình thấy được có một dll đang được sử dụng ở đây, tên.dll này là Cerbera.dll</p>
            
            <img src="./../images/Readline-1.18.PNG">
            
            <p>Toàn là một số chuỗi rất khó hiểu, sẽ làm mình cảm thấy khó khi đọc nó, từ các functions cho đến các class, tên đặt có vẻ cố tình làm rối mã, kỹ thuật này được sử dụng trên rất nhiều mẫu malware.</p>
            <img src="./../images/Readline-1.19.PNG">
            <p>Các bạn biết Assembly assembly = Assembly.Load(rawAssembly); là nó đang cố load 1 đoạn assembly từ một dãy byte (raw byte array), dãy byte đang nằm trong rawAssembly!   </p>
            <img src="./../images/Readline-1.20.PNG">

            <img src="./../images/Readline-1.21.PNG">
            <p>^^ Mình thấy nó load IvectorView.dll.</p>
            <img src="./../images/Readline-1.27.PNG">
            <p>Tiếp theo các bạn sẽ thấy được methodInfo.Invoke(null, null), nó đang cố gọi một phương thức (method) sử dụng đối tượng MethodInfo </p>
            <img src="./../images/Readline-1.22.PNG">
            <p>Theo dõi nó thử xem, nó đã tạo ra process conhost.exe.</p>
            <img src="./../images/Readline-1.26.PNG">
            <img src="./../images/Readline-1.23.PNG">
            <p>Thử xem chi tiết conhost này có những thông tin gì</p>
            <img src="./../images/Readline-1.24.PNG">
            <img src="./../images/Readline-1.25.PNG">
            
            


        </section>
        <section id="section4">
            <h2>Phân tích động (Dynamic malware analysis) </h2>
            <h4 id="behavior">Phân tích hành vi</h4>
            <p> Chạy thử và theo dõi nó sẽ gọi MethodInfo.Invoke và inject code vào trong.</p>
            <p>Mình save this entire memory cả 2 dll con malware này load vào phía trên nữa nhé!</p>
            <img src="./../images/Readline-1.29.PNG">
            <p>SHA1 hash of IVectorView.dll: c396be70fe1c653b8a239dd61213780186e9569f</p>
            <p>SHA1 hash of Cerbera.dll: e218e2b2a8c8e204c19d6cc6aec987b87544d566</p>
            <h4 id="dump">Dump thử process liên quan</h4>
            <p>Mình đã theo dõi mình sẽ dump file 3bd982f82a1b2f074b02fe7cc7413f1e083f19108ae2612b2b5a741a9858f7f4.exe để kiểm tra có gì thú vị ở trong này không. </p>
            <img src="./../images/Readline-1.30.PNG">
            <p>Lấy string file dmp xem có phát hiện gì mới không, ở đây mình tìm thấy rất nhiều chuỗi, lọc thêm một số chuỗi chứa http nữa, bạn sẽ thấy có vẻ C&C của nó nằm trong đây.</p>
            <img src="./../images/Readline-1.31.PNG">
            <img src="./../images/Readline-1.33.PNG">
            <p>Mình tìm thấy C2:</p>
            <p><a href="https://www.virustotal.com/gui/ip-address/2.56.59.101/detection">2.56[.]59.101:17559</a></p>


        </section>
        <section id="section3">
            <h2>Kết luận</h2>
            <p>Trong suốt quá trình phân tích, mình đã cố gắng phân tích mẫu Redline Stealer này nhưng sẽ rất khó hiểu nếu như các bạn chỉ đọc, nếu các bạn đi từ từ và phân tích chúng, các bạn sẽ hiểu những gì mình nói, có thể quá mới mẻ nhưng hãy tập làm quen với điều đó, Redline Stealer ảnh hưởng rất lớn đến người dùng Việt Nam, lời khuyên dành cho bạn không sử dụng phần mềm crack, hay những phần mềm không rõ nguồn gốc để tránh dính Redline Stealer nhé!</p>
        </section>

    </div>
    <footer>
        <p>&copy; 2023 Mai Lam Anh CyberS3c</p>
    </footer>
</body>
</html>
